CREATE TABLE viagens (
       codigo NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
       ida VARCHAR2(20),
       volta VARCHAR2(20),
       dataida DATE,
       datavolta DATE
);

ALTER TABLE viagens
ADD CONSTRAINT codigo_viagem_pk
PRIMARY KEY (codigo);

INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('São Paulo','Londres',TO_DATE('2022-06-12 09:30','YYYY-MM-DD HH24:MI'),TO_DATE('2022-06-21 17:00','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('Nova Iorque','Berlim',TO_DATE('2022-07-21 10:45','YYYY-MM-DD HH24:MI'),TO_DATE('2022-08-03 11:00','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('Rio de Janeiro','Buenos Aires',TO_DATE('2022-08-19 11:00','YYYY-MM-DD HH24:MI'),TO_DATE('2022-09-01 12:00','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('Manaus','Cidade do México',TO_DATE('2022-10-07 15:00','YYYY-MM-DD HH24:MI'),TO_DATE('2022-10-31 06:00','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('São Paulo','Lisboa',TO_DATE('2022-07-06 16:45','YYYY-MM-DD HH24:MI'),TO_DATE('2022-08-10 14:00','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('Brasília','São Paulo',TO_DATE('2022-11-12 08:30','YYYY-MM-DD HH24:MI'),TO_DATE('2022-11-19 15:50','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('Belo Horizonte','Bogotá',TO_DATE('2022-09-07 17:00','YYYY-MM-DD HH24:MI'),TO_DATE('2022-09-21 06:30','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('São Paulo','Belo Horizonte',TO_DATE('2022-07-06 10:00','YYYY-MM-DD HH24:MI'),TO_DATE('2022-07-10 16:30','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('Belo Horizonte','Porto Alegre',TO_DATE('2022-08-20 07:30','YYYY-MM-DD HH24:MI'),TO_DATE('2022-08-25 14:00','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('Joinville','Porto Alegre',TO_DATE('2022-06-29 08:30','YYYY-MM-DD HH24:MI'),TO_DATE('2022-07-05 18:00','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('Rio de Janeiro','Dubai',TO_DATE('2022-07-20 08:50','YYYY-MM-DD HH24:MI'),TO_DATE('2022-08-15 06:00','YYYY-MM-DD HH24:MI'));
INSERT INTO viagens (ida,volta,dataida,datavolta) VALUES ('São Paulo','Manaus',TO_DATE('2022-07-17 07:00','YYYY-MM-DD HH24:MI'),TO_DATE('2022-07-23 20:30','YYYY-MM-DD HH24:MI'));


-- Mostrar quantas vezes cada cidade aparece na ida

SELECT ida,COUNT(*) FROM viagens GROUP BY ida

-- Listar a quantidade de idas no periodo matutino, vespertino e noturno

SELECT 
COUNT (*) AS qntd,
(CASE 
 WHEN TO_CHAR(dataida,'HH24') <= 12 THEN 'MATUTINO' 
 WHEN TO_CHAR(dataida,'HH24') <= 18 THEN 'VESPERTINO' 
 ELSE 'NOTURNO' 
END) AS turno
FROM viagens
GROUP BY 
(CASE 
 WHEN TO_CHAR(dataida,'HH24') <= 12 THEN 'MATUTINO' 
 WHEN TO_CHAR(dataida,'HH24') <= 18 THEN 'VESPERTINO' 
 ELSE 'NOTURNO' 
END)


SELECT
   turno,
   COUNT(turno)
FROM(
   SELECT
   (CASE
     WHEN TO_CHAR(dataida,'HH24') <= 12 THEN 'MATUTINO' 
     WHEN TO_CHAR(dataida,'HH24') <= 18 THEN 'VESPERTINO' 
     ELSE 'NOTURNO'
   END) AS turno
   FROM viagens
)
GROUP BY turno;


-- Listar ida e volta, onde a data de volta seja em julho (07)

SELECT dataida,datavolta 
FROM viagens 
WHERE TO_CHAR(datavolta,'MM') = 07;

-- Listar todos os dados onde a ida ou volta seja para dubai

SELECT * 
FROM viagens 
WHERE ida = 'Dubai' OR volta = 'Dubai';

-- Listar todos os dados onde a data ida seja no mês de julho e de manhã

SELECT *
FROM viagens 
WHERE TO_CHAR(dataida,'MM') = 07 AND TO_CHAR(dataida,'HH24') < 12;

-- Cidade que mais aparece na ida e sua quantidade 

SELECT MAX(ida),
COUNT (*) AS qntd
FROM viagens 
WHERE ida = (SELECT MAX(ida) FROM viagens)

-- Cidade que mais aparece na volta <<<<<<<<<<<<

SELECT MAX(volta),
COUNT (*) AS qntd
FROM viagens 
WHERE volta = (SELECT MAX(volta) FROM viagens)

-- Todos os dados ordenados pela data ida

SELECT * FROM viagens ORDER BY dataida ASC



